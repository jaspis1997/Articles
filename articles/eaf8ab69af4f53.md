---
title: "pnpmを使ってNode.jsのバージョン管理から開放される"
emoji: "🍣"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["pnpm", "Nodejs", "vite"]
published: false
---

## はじめに

この記事では、複数のNode.jsバージョンを管理する必要がある開発者向けに、効率的な方法を紹介します。とくに、フロントエンドやバックエンドの開発でNode.jsを利用するシーンが多い昨今、バージョン管理の手法を理解しておくことは重要です。プロジェクトごとに異なるNode.jsのバージョンを使う必要がある場合、その切り替えを手作業で行うのは非効率で、設定ミスによるトラブルが発生しやすくなります。

多くの開発者は、nvmやVoltaなどのツールを使ってNode.jsのバージョンを管理していますが、今回は近年注目されているパッケージマネージャーのpnpmを取り上げます。pnpmは、Node.jsの依存関係を効率的に扱うだけでなく、プロジェクトごとのNode.jsバージョン管理も可能です。

この記事では、pnpmを使ったNode.jsのバージョン管理の具体的な手法を解説します。pnpmならではの特徴や利便性を最大限活用する方法も紹介します。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
## pnpmとは

pnpmは、Node.jsのパッケージ管理を効率的に行うためのツールで、他のパッケージマネージャー（npmやYarn）とは異なる特長を持っています。とくに、ディスク使用量の削減やインストール速度の高速化に優れています。

pnpmの最大の特徴は、パッケージをグローバルなストレージに一度だけ保存し、複数のプロジェクトでそのパッケージを共有する仕組みを採用している点です。これにより、同じ依存関係を持つ複数のプロジェクト間での重複が排除され、ディスクスペースが効率よく利用されます。これに対して、従来のnpmやYarnでは、プロジェクトごとに依存関係が個別にインストールされるため、ディスク容量が増大しがちです。

また、pnpmは厳格なパッケージ管理も特徴的です。pnpmでは、依存関係のツリー構造がプロジェクトごとに独立しているため、あるプロジェクトの依存関係が他のプロジェクトに影響を与えることがありません。これにより、パッケージの依存関係の競合や不整合が発生するリスクを低減し、開発環境の安定性が向上します。npmやYarnでは、依存関係がグローバルに共有されてしまい、プロジェクト間の干渉が発生しやすいという問題がありますが、pnpmではこの問題が解決されています。

また、pnpmはNode.jsのバージョン管理機能も提供しており、プロジェクトごとに異なるバージョンのNode.jsを手軽に切り替えることができます。この機能により、プロジェクトのバージョン不整合によるトラブルを防ぎ、開発環境の整合性を保つことができます。

さらに、pnpmはインストール速度が速いことでも評価されています。pnpmの独自のアーキテクチャは、依存関係の解決とインストール処理を最適化しているため、大規模なプロジェクトや複雑な依存関係を持つプロジェクトでも素早くセットアップが可能です。

総じて、pnpmはディスク効率の高いパッケージ共有、厳格な依存関係管理、そして迅速なインストールを実現する優れたパッケージマネージャーです。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
## pnpmのインストール

### Node.jsのバージョン確認

```msshell:powershell
node -v
```
`v18.0` 以降であればOKです

```msshell:powershell
v20.15.1
```

### pnpmのインストール

```msshell:powershell
npm install -g pnpm
```

これで、pnpmがインストールされます。
時折、corepackを使ったインストール例も見かけることがありますが、廃止されることが検討されているため、今回は使いません。

pnpmが正しくインストールされたかどうかを確認するため、以下のコマンドを実行してバージョンを表示します。

```msshell:powershell
pnpm -v
```

無事、pnpmのインストールができたら準備は整いました。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
## Node.jsのバージョン管理方法

これで、`package.json` が作成され、プロジェクトがpnpmに対応します。

pnpmの設定は、プロジェクトルートに .npmrcファイルを作成することでカスタマイズ可能です。たとえば、pnpmでプロジェクトごとにNode.jsのバージョンを固定する設定を行います。

```ini:.npmrc
use-node-version=20.15.1
```

## pnpmを実際に使ってみる

ここでは、pnpmを使ってプロジェクトを管理する基本的な手順を紹介します。pnpmを利用することで、パッケージのインストールやスクリプトの実行が効率化され、Node.jsのバージョン管理も簡単に行えます。

### packageのインストール

```msshell:powershell
pnpm add <package-name>
```

npm同様、「-D」オプションをつけることで開発用として依存関係に追加できます。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
### シンプルな構成のプロジェクト

pnpmの基本的な動作を確認するために、簡単なプロジェクトを作成し、Node.jsのパッケージ管理を実際に試してみましょう。以下では、プロジェクトの作成からpnpmのコマンド実行までの流れを紹介します。

#### プロジェクトの初期化
新しいプロジェクトフォルダーを作成し、pnpmでプロジェクトを初期化します。

```msshell:powershell
pnpm init
```

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
### Viteプロジェクトでの動作確認

ここでは、Viteを使ったプロジェクトのセットアップと動作確認の手順を紹介します。Viteは、フロントエンドの高速な開発環境を提供するビルドツールで、`pnpm` との組み合わせで効率的なプロジェクト管理が可能です。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
#### Viteプロジェクトの作成

まず、`pnpm` を使ってViteプロジェクトを初期化します。

```mshell:powershell
pnpm create vite
```

実行後、対話式でプロジェクトの詳細を入力します。たとえば、フレームワークにReactを選ぶ場合、以下のような選択が可能です。

```msshell:powershell
√ Project name: ... my-vite-project
√ Select a framework: » React
√ Select a variant: » TypeScript
```

これにより、Viteのテンプレートが生成され、プロジェクトの初期構成が整います。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
#### 依存関係のインストール

プロジェクトフォルダーに移動し、依存パッケージをインストールします。

```msshell:powershell
pnpm install
```

これで、ViteやReactなどの必要なパッケージがインストールされ、 `pnpm-lock.yaml` ファイルも自動的に生成されます。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
#### Viteの設定ファイルの確認

Viteでは、設定ファイルとしてvite.config.tsがデフォルトで用意されています。この設定ファイルでビルドプロセスをカスタマイズ可能です。最初の段階ではとくに変更せず、そのまま進めます。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
#### 開発サーバーの起動

```msshell:powershell
pnpm run dev
```
```msshell:powershell
VITE v4.0.0  ready in 300ms

  ➜  Local:   http://localhost:3000/
  ➜  Network: http://192.168.0.10:3000/
```

ブラウザで `http://localhost:3000` にアクセスすると、Viteの初期ページが表示されます。
実行できていることが確認できました。

<!-- TODO: 初稿。冗長な表現や記事の内容としての整合性を調査する -->
## まとめ

本記事では、pnpmを使ったNode.jsのバージョン管理と、Viteを活用したプロジェクトのセットアップについて解説しました。まず、pnpmは従来のパッケージマネージャーと異なり、厳格なパッケージ管理とディスク使用量の削減、高速なインストールを特徴としています。とくに、複数プロジェクト間で異なるNode.jsバージョンを扱う際、その利便性が際立ちます。さらに、`.npmrc` 設定ファイルを活用し、プロジェクトごとに自動的に適切なNode.jsバージョンを切り替えることも可能です。

また、Viteを利用することで、開発サーバーの起動やホットリロード機能を使った効率的な開発環境を構築できます。pnpmを使って依存パッケージを管理しながら、Viteの高速ビルドとプレビューサーバーでプロジェクトを簡単に実行し、プロダクションビルドまでスムーズに行えます。

これにより、煩雑なバージョン管理から解放され、開発者はプロジェクトの本質的な部分に集中できるようになります。pnpmとViteを組み合わせたシンプルで効率的な開発手法を導入することで、Node.jsプロジェクトの管理と開発体験を大幅に改善できるはずです。